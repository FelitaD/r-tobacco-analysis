---
title: "R Notebook"
output: html_notebook
---
```{r}
library(tidyverse)
library(scales)
library(reshape2)
library(ggplot2)
library(xts)
library(zoo)
library(tsbox)
```

```{r}
  data <- read.csv("~/CNAM/Stats/Mini-memoire/data/data_1985_2019_cleaned")
  data <- data_1985_2019
```

## Analyse des relations entre tabac et sante mentale au cours du temps
POORHLTH, MENTHLTH, SMOKE100 -> 1996 - 2019

#### Choix des variables

```{r}
    poorhtlth_mentlth_smoke100 <- data %>%
      select(IDATE, IYEAR,  SMOKE100 , POORHLTH, MENTHLTH)

    poorhtlth_mentlth_smoke100 <- drop_na(poorhtlth_mentlth_smoke100) 
```

#### Aggregation par annee

```{r}
    agg_day <- poorhtlth_mentlth_smoke100  %>%
                    filter(IYEAR != 2020) %>%
                    group_by(IDATE) %>% 
                    summarise(POORHLTH = mean(POORHLTH),
                            MENTHLTH = mean(MENTHLTH),
                            SMOKE100 = mean(SMOKE100)) 
```

#### Creation de times series

```{r}
  agg_day$IDATE <- as.Date(agg_day$IDATE, format="%Y-%m-%d")
  agg_day_date <- agg_day$IDATE
  agg_day <- agg_day %>% select(-IDATE)
  
  xts_day <- xts(agg_day, agg_day_date) 
  ts <- ts_ts(xts_day)
  print(ts)
  plot(ts)
  colnames(ts)
  ts.plot(ts, col = 2:3, xlab = "Year", ylab = "Nombre de jours", main = "tobacco and mental heath")
  legend("topleft", n[2:3], lty = 1, col = 2:3, bty = "n")
```
# scale

- Par annee

```{r}
    agg_year <- data_subset  %>%
                    filter(IYEAR != 2020) %>%
                    group_by(IYEAR) %>% 
                    summarize(ADDEPEV2 = mean(ADDEPEV2),
                            POORHLTH = mean(POORHLTH),
                            MENTHLTH = mean(MENTHLTH),
                            X_RFSMOK3 = mean(X_RFSMOK3)) 
```


```{r}
  data_date <- agg_day$IYEAR
  agg_day <- agg_day %>% select(-IDATE)
  ts <- xts(data, agg_day) 
  plot(ts)
```

```{r}
  smokers_mentalhealth <- ts_ts(ts)
  print(smokers_mentalhealth)
  plot(smokers_mentalhealth)
  colnames(smokers_mentalhealth)
```

```{r}
print(a)
start(a)
end(a)
frequency(a)
deltat(a)
plot(a)
```

#### DIVISION EN TIMES SERIES UNIVARIES

```{r}
  smokers_ts <- smokers_mentalhealth[, 'X_RFSMOK3']
  depress_ts <- smokers_mentalhealth[, 'ADDEPEV2']
  poor_phys_mental_ts <- smokers_mentalhealth[, 'POORHLTH']
  poor_mental_ts <- smokers_mentalhealth[, 'MENTHLTH']
  ts.plot(smokers_ts)
  ts.plot(depress_ts)
  ts.plot(poor_phys_mental_ts)
  ts.plot(poor_mental_ts)
```

 <!-- Ressemble a du white noise : mean and variance constante, pas de correlations over time (pas de seasonal trends) -->
 <!-- Bemol quand meme perdiodicite cycle d'un an (du au fetes moins d'interviews)  -->

## WHITE NOISE MODEL - POOR MENTAL HEALTH

```{r}
ts.plot(poor_mental_ts)
poor_mental_ts_diff <- diff(poor_mental_ts, lag = 4) # remove long term (seasonal) trends
ts.plot(poor_mental_ts_diff)
```

Base pour d'autres modeles de time series

ARIMA(p, d, q)
- auto-regressive p
- order of integration (differencing) d
- moving average order q

#### Estimation

```{r}
arima(poor_mental_ts_diff, order=c(0, 0, 0))
```
```{r}
lapply(poor_mental_ts_diff, mean, na.rm = TRUE)
lapply(poor_mental_ts_diff, var, na.rm = TRUE)
```
> La comparaison de la moyenne et de la variance est quasi-identique

brfss_2001$QLMENTL2
brfss_1985$QLSTRES2
brfss_1985$EMTSUPRT
brfss_1985$LSATISFY

brfss_2010$ADDEPEV2



brfss_1985$X_STATE
brfss_1985$NUMADULT
brfss_1985$MARITAL
brfss_1985$EDUCA
brfss_1985$SEX
brfss_1985$X_AGEG5YR
brfss_1985$SMOKE100

brfss_1995$X_STATE
brfss_1995$NUMADULT
brfss_1995$MENTHLTH
brfss_1995$POORHLTH
brfss_1995$MARITAL
brfss_1995$EDUCA
brfss_1995$SEX
brfss_1995$X_AGEG5YR
brfss_1995$X_AGE65YR
brfss_1995$SMOKE100

brfss_2000$X_STATE
brfss_2000$NUMADULT
brfss_2000$MENTHLTH
brfss_2000$POORHLTH
brfss_2000$MARITAL
brfss_2000$EDUCA
brfss_2000$INCOME2
brfss_2000$SEX
brfss_2000$X_AGEG5YR
brfss_2000$X_AGE65YR
brfss_2000$SMOKE100

brfss_2005$X_STATE
brfss_2005$NUMADULT
brfss_2005$MENTHLTH
brfss_2005$POORHLTH
brfss_2005$MARITAL
brfss_2005$CHILDREN
brfss_2005$EDUCA
brfss_2005$INCOME2
brfss_2005$SEX
brfss_2005$X_AGEG5YR
brfss_2005$X_AGE65YR
brfss_2005$X_AGE_G
brfss_2005$X_CHLDCNT
brfss_2005$X_EDUCAG
brfss_2005$X_INCOMG
brfss_2005$SMOKE100
brfss_2005$SMOKDAY2
brfss_2005$STOPSMK2
brfss_2005$X_SMOKER3
brfss_2005$X_RFSMOK3

brfss_2008$X_STATE
brfss_2008$NUMADULT
brfss_2008$MENTHLTH
brfss_2008$POORHLTH
brfss_2008$MARITAL
brfss_2008$CHILDREN
brfss_2008$EDUCA
brfss_2008$INCOME2
brfss_2008$VETERAN3
brfss_2008$SEX
brfss_2008$X_AGEG5YR
brfss_2008$X_AGE65YR
brfss_2008$X_AGE_G
brfss_2008$X_CHLDCNT
brfss_2008$X_EDUCAG
brfss_2008$X_INCOMG
brfss_2008$SMOKE100
brfss_2008$SMOKDAY2
brfss_2008$LASTSMK2
brfss_2008$STOPSMK2
brfss_2008$X_SMOKER3
brfss_2008$X_RFSMOK3


